---
title: 数据模型设计
date: 2018-05-04 09:07:09
tags: [数据库]
categories: 架构
---
合理的数据模型架构能提升系统的扩展能力，避免系统频繁迭代。以下是我在运营商服务多年总结的数据模型架构的方法论。

数据模型大体分为三层，规则层，实例层，日志层。

规则层是对象的定义，我将规则层实体的属性分为两类，一类是关键属性，他是用来定义对象的，是对象的内涵，不可改变。其余称为非关键属性，是对象的外延，他并不能定义对象，可以随时改变。

实例层是规则的实例化，系统将外界的输入与规整层实体进行逻辑加工，例如拷贝，形成实例层实体的属性。实例层实体有一个特征，就是通常会存在状态属性。系统根据实例的状态会有不同的处理逻辑/流程。通常，系统需要实例化规则层实体的规则编号和非关键属性。

日志层主要指实例层实体状态的变化，主要是其属性值的改变。通常有个特征就是时间属性。

存在一些数据实体，兼有实例层和日志层的特征，例如订单表.即存在状态字段也存在日期字段。在不同的运行场景，他的某些特征会比较突出。例如，查询/统计的时候，其日志层的特征比较突出。例如，在支付/工作流的场景，其实例层的特征比较突出。

我们经常犯的一个错误，就是无法确定哪些规则层实体属性需要实例化至实例层实体。许多数据模型架构师，只是遵循范式，将规则层实体编号（主键）实例化至实例层实体。这样是错误的。正确做法是除了规则编号，非关键属性都需要实例化。否则，会犯刻舟求剑的错误。因为非关键属性会时刻调整，根据规则编号查询得到的永远是最新的属性而不是当时的属性。实例层实体实例化的时候，是需要所有场景的快照。否则，日后查询统计都是错误的。

而关键属性是不需要实例化的。因为关键属性改变，意味此规则非彼规则，需要新建，自然规则编号（主键）也是不一样的。
